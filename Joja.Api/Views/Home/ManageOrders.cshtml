@model IEnumerable<Joja.Api.Models.Order>
@{
    ViewData["Title"] = "Admin - Manage Orders & Content";
}

<div class="container" style="margin-top: 50px;">
    <h1 class="brand-font text-center mb-4">Admin Dashboard</h1>

    <!-- Stats Summary -->
    <div class="dashboard-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 50px;">
        <div class="card p-4 text-center border-0 shadow-sm" style="background: var(--joja-white); border-radius: 8px;">
            <h5 class="text-muted">Total Sales</h5>
            <h2 class="brand-font">@(((decimal)(ViewBag.TotalSales ?? 0)).ToString("C"))</h2>
        </div>
        <div class="card p-4 text-center border-0 shadow-sm" style="background: var(--joja-white); border-radius: 8px;">
            <h5 class="text-muted">Pending Orders</h5>
            <h2 class="brand-font" style="color: #d9534f;">@ViewBag.PendingOrders</h2>
        </div>
        <div class="card p-4 text-center border-0 shadow-sm" style="background: var(--joja-white); border-radius: 8px;">
            <h5 class="text-muted">Subscribers</h5>
            <h2 class="brand-font">@ViewBag.EmailCount</h2>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <a asp-action="AdminSubscribers" class="btn-link" style="color: var(--joja-text);">View List</a>
            </div>
        </div>
        <div class="card p-4 text-center border-0 shadow-sm" style="background: #E8F5E9; border-radius: 8px;">
            <h5 class="text-muted">Analytics</h5>
            <div style="font-size: 2rem; margin: 10px 0;"><i class="fas fa-chart-line" style="color: #2E7D32;"></i></div>
            <a href="/api/Analytics" class="btn btn-sm btn-success" style="color: white; font-weight: bold;">View Dashboard</a>
        </div>
    </div>

    <!-- Video Upload Section -->
    <div class="row mb-5" style="background: #fdfdfd; padding: 20px; border: 1px solid #eee; border-radius: 8px;">
        <div class="col-md-12">
            <h3 class="brand-font mb-3">Upload Story Video</h3>
            <form asp-action="UploadProductVideo" method="post" enctype="multipart/form-data" style="max-width: 600px;">
                <div class="mb-3" style="margin-bottom: 15px;">
                    <label class="form-label font-weight-bold">Select Product</label>
                    <select name="productId" class="form-control" style="padding: 10px; width: 100%; border: 1px solid #ccc;">
                        @if (ViewBag.Products != null)
                        {
                            foreach (var product in (List<Joja.Api.Models.Product>)ViewBag.Products)
                            {
                                <option value="@product.Id">@product.Name</option>
                            }
                        }
                    </select>
                </div>
                
                <div class="mb-3" style="margin-bottom: 15px;">
                    <label class="form-label font-weight-bold">Select Video (MP4)</label>
                    <input type="file" name="videoFile" class="form-control" accept="video/*" style="padding: 10px; width: 100%;" />
                </div>
                
                <button type="submit" class="btn-joja-dark">Save Video to Product</button>
            </form>
        </div>
    </div>

    <!-- Order Management Table -->
    <h3 class="brand-font mb-3">Recent Orders</h3>
    <div class="table-responsive">
        <table class="table table-striped align-middle" style="width: 100%; border-collapse: collapse;">
            <thead class="table-dark" style="background-color: var(--joja-black); color: white;">
                <tr>
                    <th style="padding: 12px;">Order ID</th>
                    <th style="padding: 12px;">Customer</th>
                    <th style="padding: 12px;">Date</th>
                    <th style="padding: 12px;">Total</th>
                    <th style="padding: 12px;">Status</th>
                    <th style="padding: 12px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model) {
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 12px;">#@order.Id</td>
                        <td style="padding: 12px;">@order.Customer.Email</td>
                        <td style="padding: 12px;">@order.OrderDate.ToShortDateString()</td>
                        <td style="padding: 12px;">@order.TotalAmount.ToString("C")</td>
                        <td style="padding: 12px;">
                            <select class="form-select status-dropdown" 
                                    style="padding: 5px; border-radius: 4px;"
                                    onchange="updateStatus(@order.Id, this.value)">
                                <option value="Pending" selected="@(order.Status == "Pending")">Pending</option>
                                <option value="Processing" selected="@(order.Status == "Processing")">Processing</option>
                                <option value="Shipped" selected="@(order.Status == "Shipped")">Shipped</option>
                                <option value="Delivered" selected="@(order.Status == "Delivered")">Delivered</option>
                            </select>
                        </td>
                        <td style="padding: 12px;">
                            <!-- Link to details action if needed -->
                            <button class="btn btn-sm btn-outline-dark" style="font-size: 0.8rem;">Details</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function updateStatus(orderId, newStatus) {
            $.post("/Home/UpdateOrderStatus", { orderId: orderId, newStatus: newStatus }, function(data) {
                if (data.success) {
                    // Optional: Show simplified toast/alert
                    // alert("Order #" + orderId + " updated to " + newStatus);
                    console.log("Updated " + orderId);
                    // Could add checkmark or visual feedback here
                } else {
                    alert("Error updating order.");
                }
            });
        }
    </script>
}
